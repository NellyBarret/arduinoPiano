<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>App Compare</title>
    <link rel="stylesheet" href="/static/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:100,200,300,400,500,600,700,800,900">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli">
    <link rel="stylesheet" href="/static/assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="/static/assets/fonts/simple-line-icons.min.css">
    <link rel="stylesheet" href="/static/assets/css/style.css">
</head>

<style>
    .container{
        margin-left: auto;
        margin-right: auto;
    }

</style>

<body id="page-top">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top" id="mainNav">
        <div class="container"><a class="navbar-brand js-scroll-trigger" href="#page-top">PIC</a><button data-toggle="collapse" data-target="#navbarResponsive" class="navbar-toggler float-right" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fa-bars"></i></button>
        </div>
    </nav>
    <header class="masthead" style="background:url('/static/assets/img/bg-pattern.png'), linear-gradient(to right, #7b4397, #dc2430);height:100%;">
        <div class="container h-100" id="header-container">
            <div class="row">
                <div class="col-md-8 mx-auto">
                    <button onclick="less()"><-</button>
                    <img src="/static/img/piano.png">
                    <button onclick="more()">-></button>
                </div>
                <div class="col-md-4 mx-auto">
                    <button onclick="loadTone()">Set tone synth</button>
                    <br>
                    <button onclick="loadMetal()">Set metal synth</button>
                    <br>
                    <button onclick="loadPluck()">Set pluck synth</button>
                    <br>
                    <button onclick="loadMembrane()">Set membrane synth</button>
                </div>
            </div>
        </div>
    </header>

    <footer>
        <div class="container">
            <p>Â©&nbsp;PIC 2020. All Rights Reserved.</p>
            <ul class="list-inline">
                <li class="list-inline-item"><a href="#">Privacy</a></li>
                <li class="list-inline-item"><a href="#">Terms</a></li>
                <li class="list-inline-item"><a href="#">FAQ</a></li>
            </ul>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.4.84/Tone.js"></script>
    <script src="/static/Tonejs-Instruments.js"></script>
    <script>
        //create a synth and connect it to the master output (your speakers)
      var synth = new Tone.PolySynth(Tone.Synth).toMaster();
      /*var synth = SampleLibrary.load({
                instruments: "piano",
                baseUrl: "static/samples/"
            })*/
      var socket = io('http://localhost:5000');

      var triggered = {
      }
      var previous = "1";

      var added_pitch = 0;

      socket.on('connect', function(){});
      socket.on('message', function(data){
          console.log("Recv : ", data);
        if(!(data in triggered)){
            triggered[data] = false;
        }

        if(triggered[data]){
             synth.triggerRelease([Tone.Frequency(parseInt(data)+added_pitch, 'midi')]);
        }
        else {
            //notes_to_trigger[previous] = false;
            synth.triggerAttack([Tone.Frequency(parseInt(data)+added_pitch, 'midi')]);
        }
        triggered[data] = !triggered[data];
        previous = data;


      });
      socket.on('disconnect', function(){});

      function less(){
          added_pitch -= 12;
      }

      function more(){
          added_pitch += 12;
      }

      function loadMetal(){
          synth = new Tone.PolySynth(Tone.MetalSynth).toMaster();
      }

      function loadPluck(){
          synth = new Tone.PolySynth(Tone.PluckSynth).toMaster();
      }

      function loadMembrane() {
          synth = new Tone.PolySynth(Tone.MembraneSynth).toMaster();
      }

      function loadTone(){
          synth = new Tone.PolySynth(Tone.Synth).toMaster();
      }


    </script>

</body>

</html>